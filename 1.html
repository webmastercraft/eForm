<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <title>HMCC- SURGICAL STOCKINGS</title>
    <style>
        .container {
            margin-top: 2em;
            margin-bottom: 2em;
            border: 2px solid #444;
        }
    </style>
  </head>
  <body>
    <button type="button" onclick="reset()">Reset Test</button>
    <button type="button" onclick="saveData()">Save Form</button>
    <button type="button" onclick="loadData()">Load Form</button>
    <!-- <button type="button" onclick="print()">Print</button> -->
    <button type="button" onclick="print()">Print</button>
    <form class="container mt-5 p-4">
        <div>
            <label>Re:</label>
            <input class="w-50" type="text" name="form_1_0" onkeyup="updateInputValue(name, this)" />
        </div>
        <p>To Whom It May Concern:</p>
        <p>Surgical stockings  have been prescribed for the above-mentioned patient insured by your company.</p>
        <label class="fw-bold">Symptoms:</label>
        <div class="row">
            <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_1_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_1">
                    <label class="form-check-label" for="symptoms_1">tired legs and feet</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_3_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_2">
                    <label class="form-check-label" for="symptoms_2">aching, fatigued legs</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_5_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_3">
                    <label class="form-check-label" for="symptoms_3">ankle and  leg swelling</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_7_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_4">
                    <label class="form-check-label" for="symptoms_4">poor circulation</label>
                </div>
            </div>
            <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_2_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_5">
                    <label class="form-check-label" for="symptoms_5">varicosities</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_4_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_6">
                    <label class="form-check-label" for="symptoms_6">edema</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_6_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_7">
                    <label class="form-check-label" for="symptoms_7">thrombophlebitis</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_8_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_8">
                    <label class="form-check-label" for="symptoms_8">pregnancy</label>
                </div>
            </div>
        </div>
        <div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="form_1_9_check" onclick="updateCheckBoxValue(name, this)" id="symptoms_other">
                <label class="form-check-label" for="symptoms_other">Other:</label>
                <input class="w-75" type="text" name="form_1_10" onkeyup="updateInputValue(name, this)"/>
            </div>
        </div>
        <div class="mt-3">
            <label class="fw-bold">Date of examination performed:</label>
            <input class="w-50" type="text" name="form_1_11" onkeyup="updateInputValue(name, this)">
        </div>
        <label class="fw-bold mt-2">Compression Stocking Manufacturer:</label>
        <div class="row">
            <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_12_check" onclick="updateCheckBoxValue(name, this)" id="manufacturer_1">
                    <label class="form-check-label" for="manufacturer_1">Jobst</label>
                </div>
            </div>
            <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="form_1_13_check" onclick="updateCheckBoxValue(name, this)" id="manufacturer_2">
                    <label class="form-check-label" for="manufacturer_2">Therafirm</label>
                </div>
            </div>
            <div class="col"></div>
            <div class="col"></div>
        </div>
        <div class="row my-1">
            <div class="col-3">
                <h5>Compression</h5>
            </div>
            <div class="col-lg-9 row">
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_14_check" onclick="updateCheckBoxValue(name, this)" id="compression_1">
                        <label class="form-check-label" for="compression_1">15 - 20 mmHg</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_15_check" onclick="updateCheckBoxValue(name, this)" id="compression_2">
                        <label class="form-check-label" for="compression_2">20 - 30 mmHg</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_16_check" onclick="updateCheckBoxValue(name, this)" id="compression_3">
                        <label class="form-check-label" for="compression_3">30 - 40 mmHg</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-3"><h5>Style: </h5></div>
            <div class="col-9 row">
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_17_check" onclick="updateCheckBoxValue(name, this)" id="style_knee">
                        <label class="form-check-label" for="style_knee">knee</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_18_check" onclick="updateCheckBoxValue(name, this)" id="style_thigh">
                        <label class="form-check-label" for="style_thigh">thigh</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_19_check" onclick="updateCheckBoxValue(name, this)" id="style_waist">
                        <label class="form-check-label" for="style_waist">waist</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="form_1_20_check" onclick="updateCheckBoxValue(name, this)" id="style_maternity">
                        <label class="form-check-label" for="style_maternity">maternity</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-2">
            <label class="fw-bold">Comments:</label>
            <input class="w-75" type="text" name="form_1_21" onkeyup="updateInputValue(name, this)">
        </div>
        <p>
            Cost of the surgical stockings is shown on the attached receipt.
            <br />
            Please feel free to contact me if you have any further questions.
            <br />
            Sincerely, 
        </p>
        <p class="text-center">
            <input class="w-50" type="text" name="form_1_22" onkeyup="updateInputValue(name, this)"/>
            <br />
            Dr. Mark Renzoni  D.C., R.M.T., H.B.Sc.
        </p>
    </form>
  </body>
  <script type="text/javascript">
    var test_data = {
        
    }
    var fileObject=new Object()
    function updateInputValue(key, el){
        fileObject[key]=$(el).val();
        console.log(fileObject);
    }
    function updateRadioValue(key, el){
        fileObject[key]=($(el).val() === 'true');
        console.log(fileObject);
    }
    function updateCheckBoxValue(key, el){
        fileObject[key]=$(el)[0].checked;
        console.log(fileObject);
    }
    function reset(data = test_data) {
        $('form').trigger("reset");
        $.each(data, function(key, value) {
            if(typeof value == 'string') {
                $('[name='+key+']').val(value);
            } else if(typeof value == 'boolean') {
                if ($('input[name='+key+']').attr('type') == 'radio') {
                    $('input[name='+key+'][value='+value+']').prop("checked",true);
                } else {
                    $('input[name='+key+']')[0].checked = value;
                }
            }
        })
    }
    //firebase save and load data function
    function loadData(){
        var jsonToPost=new Object()
        jsonToPost['action']='load'
        jsonToPost['pageName']='softform_1'
        $.ajax({
            type: 'POST',
            dataType: 'text',
            url: "https://jeavensoftcdn.com/icarus/V2Update/test.php",
            data: jsonToPost,
            async: true,
            success: function (data) {
                    var requestUrl = JSON.parse(data);//returned data as json need to be put back on the form   
                    console.log("requestUrl:"+JSON.stringify(requestUrl));
                    resetData(JSON.parse(data));
            },error: function (request,status,errorThrown) {    
                alert("Please Contact Admin!<br>"+errorThrown)
            }
        });
    }
    function saveData(){
        var jsonToPost=new Object()
        jsonToPost['pageName']='softform_1'
        jsonToPost['action']='save'
        jsonToPost['fileObject']=fileObject
        $.ajax({
            type: 'POST',
            dataType: 'text',
            url: "https://jeavensoftcdn.com/icarus/V2Update/test.php",
            data: jsonToPost,
            async: true,
            success: function (data) {
                var requestUrl = data;
                console.log("requestUrl:"+requestUrl);
            },error: function (request,status,errorThrown) {    
                alert("Please Contact Admin!<br>"+errorThrown)
            }
        });
    }

    function resetData(data = test_data) {
        $('form').trigger("reset");
        $.each(data, function(key, value) {
            if ($('input[name='+key+']').attr('type') == 'checkbox') {
                $('input[name='+key+']')[0].checked = (value === 'true');
            } else if ($('input[name='+key+']').attr('type') == 'radio') {
                $('input[name='+key+'][value='+value+']').prop("checked",true);
            } else {
                $('[name='+key+']').val(value);
            }
        })
    }
    function print(){
        saveData();
        $.ajax({
            headers: {"Access-Control-Allow-Origin": '*'},
            method: "POST",
            url: "https://jeavensoft.com/eForm/print1.php",
            dataType: 'json',
            data: $('form').serialize(),
            async: true,
            success: function(data) {
                console.log("print_success", data);
            },
            error: function(error) {
                console.log("print_fail", error);
            }
        });
    }
    function printJSPDF(){
        html2canvas($('form'), {
            onrendered: function(canvas) {
                if (navigator.userAgent.indexOf("MSIE ") > 0 || 
                    navigator.userAgent.match(/Trident.*rv\:11\./)) {
                    var blob = canvas.msToBlob();

                    window.navigator.msSaveBlob(blob,'Test file.png');

                }
                else   {
                    var imgData = canvas.toDataURL('image/png', 0.1);
                    var doc = new jsPDF('p', 'mm', 'letter', true);

                    var pwidth = doc.internal.pageSize.width - 30;
                    var pheight = doc.internal.pageSize.height;

                    var imgHeight = canvas.height * pwidth / canvas.width;
                    var heightLeft = imgHeight;
                    var position = 20

                    doc.addImage(imgData, 'JPEG', 15, position, pwidth, imgHeight, undefined, 'FAST');

                    heightLeft -= pheight;

                    while (heightLeft >= 0) {
                      position = heightLeft - imgHeight;
                      doc.addPage();
                      doc.addImage(imgData, 'JPEG', 15, position, pwidth, imgHeight, undefined, 'FAST');
                      heightLeft -= pheight;
                    }
                    doc.save('ExportFile.pdf');
                 }
            }
        });
    }
  </script>
</html>